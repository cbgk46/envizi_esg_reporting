<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustainability Questionnaire - FastAPI App</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="questionnaire-page">
    <div class="header">
        <h1>ðŸŒ± Sustainability Questionnaire</h1>
        <div class="welcome">
            Welcome, <strong>{{ user_name }}</strong>! Please complete the sustainability assessment below.
            <br><small>This questionnaire contains {{ total_questions }} questions across multiple sustainability dimensions.</small>
        </div>
    </div>
    
    <div class="questionnaire-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progress"></div>
        </div>
        
        <form method="POST" action="/submit-questionnaire" id="questionnaire-form">
            {% for question in questions %}
            <div class="question">
                <h3>{{ loop.index }}. {{ question.question }}</h3>
                <div class="question-meta">
                    <span class="dimension">Dimension: {{ question.dimension }}</span>
                    <span class="element">Element: {{ question.element }}</span>
                </div>
                <div class="options">
                    {% for value, label in responses.items() %}
                    <div class="option">
                        <input type="radio" id="{{ question.questionId }}-{{ value }}" name="{{ question.questionId }}" value="{{ value }}" 
                               {% if loop.first %}required{% endif %} 
                               {% if debug_mode and value|int == debug_default_score %}checked{% endif %}>
                        <label for="{{ question.questionId }}-{{ value }}">{{ value }} - {{ label }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
            
            <div style="text-align: center; margin-top: 2rem;">
                <button type="submit">Submit Questionnaire</button>
                <a href="/logout"><button type="button">Logout</button></a>
            </div>
        </form>
    </div>
    
    <script>
        // Progress bar functionality
        const form = document.getElementById('questionnaire-form');
        const progressBar = document.getElementById('progress');
        const totalQuestions = {{ total_questions }};
        
        function updateProgress() {
            const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
            const progress = (answeredQuestions / totalQuestions) * 100;
            progressBar.style.width = progress + '%';
        }
        
        // Update progress when radio buttons change
        document.addEventListener('change', function(e) {
            if (e.target.type === 'radio') {
                updateProgress();
            }
        });
        
        // Form validation
        form.addEventListener('submit', function(e) {
            const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
            if (answeredQuestions < totalQuestions) {
                e.preventDefault();
                alert('Please answer all questions before submitting.');
            }
        });
    </script>
    {% if debug_mode %}
    <script>
        // Initial progress update for debug mode
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
        });
    </script>
    {% endif %}
</body>
</html> 